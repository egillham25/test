"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[567],{18191:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0;var r={prod:"grammarly.com",preprod:"ppgr.io",qa:"qagr.io"};t.config=function(e){var t=r[e];return{url:{properties:"https://properties."+t,treatment:"https://treatment."+t,gates:"https://gates."+t}}}},674:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_ASSIGNED=t.Experiment=void 0;var r=function(){function e(e,t){void 0===t&&(t=[]),this.name=e,this._experiences=t}return Object.defineProperty(e.prototype,"experiences",{get:function(){return Object.fromEntries(this._experiences.map((function(e){return[e,e]})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"experiencesArray",{get:function(){return this._experiences},enumerable:!1,configurable:!0}),e}();t.Experiment=r,t.NOT_ASSIGNED="NOT_ASSIGNED"},38117:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExperimentClient=void 0;var s=r(674),o=r(54858),a=r(38730),c=r(3130);t.ExperimentClient=function(e,t,r,u,l){var h=this;void 0===l&&(l={}),this._treatmentService=e,this._experiments=t,this._gatesService=r,this._gates=u,this._config=l,this._experimentTreatments=new Map,this._gateTreatments=new Map,this._initialFetched=!1,this.setPrefetchedTreatments=function(e){if(h._startRefreshIfNeeded(),!c.validateTreatmentsWithType(e))throw new Error("Not valid treatments");h._updateTreatmentForExpAndGates(e)},this._updateTreatmentForExpAndGates=function(e){h._treatmentService.refresh&&h._treatmentService.refresh(),h._experimentTreatments=new Map(e.filter((function(e){return e.type===o.ExperimentType.experiment})).map((function(e){return[e.experimentName,e]}))),h._gateTreatments=new Map(e.filter((function(e){return e.type===o.ExperimentType.gate})).map((function(e){return[e.experimentName,e]})))},this.fetchTreatments=function(e){return void 0===e&&(e={}),n(h,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._startRefreshIfNeeded(),[4,this._fetchTreatments(e.clearCacheOnError)];case 1:return t.sent(),[2]}}))}))},this._fetchTreatments=function(e){return n(h,void 0,void 0,(function(){var t,r,n,s,o,a,c;return i(this,(function(i){switch(i.label){case 0:t=null,r=null,i.label=1;case 1:return i.trys.push([1,3,,4]),n=this._experiments.concat(this._gates),[4,this._treatmentService.getTreatment(n.map((function(e){return e.name})))];case 2:return t=i.sent(),[3,4];case 3:return s=i.sent(),r=s,e&&this._experimentTreatments.clear(),[3,4];case 4:if(t)return this._updateTreatmentForExpAndGates(t),[2];o=null,a=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this._gatesService.getTreatment(this._gates.map((function(e){return e.name})))];case 6:return o=i.sent(),[3,8];case 7:return c=i.sent(),a=c,e&&this._gateTreatments.clear(),[3,8];case 8:if(o&&(this._gateTreatments=new Map(o.map((function(e){return[e.experimentName,e]})))),a||r)throw a||r;return[2]}}))}))},this._startRefreshIfNeeded=function(){h._initialFetched||(h._config.ttl&&(h._refreshTreatment=setInterval((function(){return n(h,void 0,void 0,(function(){var e,t=this;return i(this,(function(r){switch(r.label){case 0:return e=function(){return n(t,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._fetchTreatments()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},this._config.ttl&&this._config.useRefreshJitter?(this._delayedRefreshTreatment=setTimeout(e,.1*this._config.ttl*Math.random()),[3,3]):[3,1];case 1:return[4,e()];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}),h._config.ttl)),h._initialFetched=!0)},this.dispose=function(){h._refreshTreatment&&clearInterval(h._refreshTreatment),h._delayedRefreshTreatment&&clearTimeout(h._delayedRefreshTreatment)},this.getTreatment=function(e){var t=h.peekTreatment(e);return null!==t&&h.logTreatment(e,t).catch((function(){})),t},this.getTreatmentManakin=function(e){var t=h.getTreatment(e);return t===s.NOT_ASSIGNED?null:t},this.peekTreatment=function(e){var t=h._experimentTreatments.get(e.name)||h._gateTreatments.get(e.name),r=null==t?void 0:t.groupName;if(0===e.experiencesArray.length||a.getExperienceName(null!=r?r:"")===s.NOT_ASSIGNED)return a.getExperienceName(null!=r?r:"");if(r){var n=e.experiencesArray.find((function(e){return a.getGroupNames(e).includes(r)}));if(n)return n}return null},this.peekTreatmentManakin=function(e){var t=h.peekTreatment(e);return t===s.NOT_ASSIGNED?null:t},this.logTreatment=function(e,t){if(h._config.ssrDisableLogging)return Promise.resolve();var r=h._experimentTreatments.get(e.name)||h._gateTreatments.get(e.name);if(!r||a.getExperienceName(r.groupName)!==t)throw new Error("Cannot find associated treatment");return(void 0!==r.needLog?r.needLog:r.type!==o.ExperimentType.gate)?h._treatmentService.logTreatment(r):Promise.resolve()},this.isGateEnabled=function(e){return h._getExperienceOfEnabledGate(e.name)===e.experience},this._getExperienceOfEnabledGate=function(e){var t=h._gateTreatments.get(e);return t?a.getExperienceName(t.groupName):null},this.getDynamicConfiguration=function(e){var t=h._experimentTreatments.get(e.name)||h._gateTreatments.get(e.name);return t&&t.dynamicConfiguration?t.dynamicConfiguration:null}}},54858:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ExperimentType=void 0,(r=t.ExperimentType||(t.ExperimentType={})).experiment="experiment",r.gate="gate"},37818:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gate=void 0;t.Gate=function(e,t){void 0===t&&(t="enabled"),this.name=e,this.experience=t}},78950:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GatesService=void 0;var s=r(18191),o=r(68510),a=r(3130),c=function(){function e(e,t,r){this.type="gate",this._httpClient=new o.HttpClient(e,t),this._gatesUrl=s.config(r).url.gates+"/gates/get"}return e.prototype.getTreatment=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return[4,this._httpClient.post(this._gatesUrl,e)];case 1:if(t=r.sent(),a.validateTreatmentsWithType(t))return[2,t];throw new Error("Did not get valid gate treatments")}}))}))},e}();t.GatesService=c},68510:function(e,t){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;var s=function(){function e(e,t){var r=this;this._fetch=e,this._config=t,this._fetchWithTimeout=this._config.timeout?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.race([r._fetch.apply(r,e),new Promise((function(e,t){return setTimeout((function(){return t(new Error("Timeout"))}),r._config.timeout)}))])}:this._fetch}return e.prototype.get=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return[4,this._getHeaders()];case 1:return t=n.sent(),[4,this._fetchWithTimeout(e,{credentials:"include",mode:"cors",headers:t})];case 2:return r=n.sent(),[2,this._parseResponse(r)]}}))}))},e.prototype.post=function(e,t){return n(this,void 0,void 0,(function(){var n,s;return i(this,(function(i){switch(i.label){case 0:return[4,this._getHeaders()];case 1:return n=i.sent(),[4,this._fetchWithTimeout(e,{method:"POST",credentials:"include",mode:"cors",headers:r(r({},n),{"Content-Type":"application/json"}),body:JSON.stringify(t)})];case 2:return s=i.sent(),[2,this._parseResponse(s)]}}))}))},e.prototype._filterHeaders=function(e){var t={};return Object.entries(e).forEach((function(e){var r=e[0],n=e[1];n&&(t[r]=n)})),t},e.prototype._getHeaders=function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._config.getApplicationHeaders?(e=this._filterHeaders,[4,this._config.getApplicationHeaders()]):[3,2];case 1:return[2,e.apply(this,[t.sent()])];case 2:throw new Error("Cannot get application headers")}}))}))},e.prototype._parseResponse=function(e){if(!e.ok)throw new Error("Network response was not ok, status "+e.status);return"application/json"===e.headers.get("Content-Type")?e.json():e.text()},e}();t.HttpClient=s},95133:(e,t,r)=>{t.iD=t.rM=t.aj=t.mP=t.eb=t.Re=void 0;var n=r(38117);Object.defineProperty(t,"Re",{enumerable:!0,get:function(){return n.ExperimentClient}});var i=r(10534);Object.defineProperty(t,"eb",{enumerable:!0,get:function(){return i.TreatmentService}});var s=r(78950);Object.defineProperty(t,"mP",{enumerable:!0,get:function(){return s.GatesService}});r(83083);var o=r(674);Object.defineProperty(t,"aj",{enumerable:!0,get:function(){return o.Experiment}}),Object.defineProperty(t,"rM",{enumerable:!0,get:function(){return o.NOT_ASSIGNED}});var a=r(37818);Object.defineProperty(t,"iD",{enumerable:!0,get:function(){return a.Gate}});r(54858)},83083:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertiesClient=void 0;var n=r(18191),i=r(68510),s=function(){function e(e,t,r){this._propertiesUrl=n.config(t).url.properties+"/properties",this._httpClient=new i.HttpClient(e,r)}return e.prototype.getAll=function(){return this._httpClient.get(this._propertiesUrl)},e.prototype.getOne=function(e){var t=this._propertiesUrl+"/"+e;return this._httpClient.get(t)},e.prototype.set=function(e){return this._httpClient.post(this._propertiesUrl,e)},e}();t.PropertiesClient=s},38730:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupNames=t.getExperienceName=void 0,t.getExperienceName=function(e){return e.endsWith("_1")||e.endsWith("_2")?e.slice(0,-2):null},t.getGroupNames=function(e){return[e+"_1",e+"_2"]}},3130:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateTreatmentsWithType=void 0;var r=function(e){return"string"==typeof e};t.validateTreatmentsWithType=function(e){return Array.isArray(e)&&e.reduce((function(e,t){return e&&r((n=t).experimentName)&&r(n.groupName)&&r(n.experimentId)&&r(n.type);var n}),!0)}},10534:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TreatmentService=void 0;var s=r(18191),o=r(68510),a=r(3130),c=function(e){var t=function(e){return e.holdoutTreatment?":"+e.holdoutTreatment.experimentId+t(e.holdoutTreatment):""};return e.groupName+":"+e.userId+":"+e.experimentId+t(e)},u=function(){function e(e,t,r,n){this._persistentStorageOpts=n,this.type="experiment",this._throttleLogs=new Map,this._sentLogs={},this._httpClient=new o.HttpClient(e,t),this._treatmentUrl=s.config(r).url.treatment+"/treatment"}return e.prototype.getTreatment=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return t=this._treatmentUrl+"/get",r=e,[4,this._httpClient.post(t,r)];case 1:if(n=i.sent(),a.validateTreatmentsWithType(n))return[2,n];throw new Error("Did not get valid treatments")}}))}))},e.prototype.logTreatment=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._checkShouldThrottle(e)||this._checkSent(e)?[2]:[4,this._sendLogTreatment(e)];case 1:return t.sent(),this._setSentLogs(e),[2]}}))}))},e.prototype.refresh=function(){this._throttleLogs.clear()},e.prototype.initSentLogsStorage=function(){return n(this,void 0,void 0,(function(){var e,t,r=this;return i(this,(function(n){switch(n.label){case 0:if(!this._persistentStorageOpts)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._persistentStorageOpts.get(this._sentLogsStorageKey)];case 2:return e=n.sent()||{},t=new Set(this._persistentStorageOpts.experimentNames),Object.entries(e).forEach((function(e){var n=e[0],i=e[1];t.has(n)&&r._updateSentLogs(n,i)})),[3,4];case 3:return n.sent(),[3,4];case 4:return[2]}}))}))},Object.defineProperty(e.prototype,"_sentLogsStorageKey",{get:function(){var t;return e.STORAGE_KEY_PREFIX+(null===(t=this._persistentStorageOpts)||void 0===t?void 0:t.clientName)},enumerable:!1,configurable:!0}),e.prototype._checkShouldThrottle=function(e){var t=c(e),r=this._throttleLogs.get(e.experimentName)===t;return r||this._throttleLogs.set(e.experimentName,t),r},e.prototype._checkSent=function(e){var t=c(e);return this._sentLogs[e.experimentName]===t},e.prototype._setSentLogs=function(e){var t=c(e);this._updateSentLogs(e.experimentName,t,!0)},e.prototype._updateSentLogs=function(e,t,r){void 0===r&&(r=!1),(r||void 0===this._sentLogs[e])&&(this._sentLogs[e]=t),r&&this._persistSentLogs()},e.prototype._persistSentLogs=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this._persistentStorageOpts?[4,this._persistentStorageOpts.set(this._sentLogsStorageKey,this._sentLogs)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},e.prototype._sendLogTreatment=function(e){var t=this._treatmentUrl+"/log";return this._httpClient.post(t,e)},e.STORAGE_KEY_PREFIX="TreatmentServiceStorage_",e}();t.TreatmentService=u},92891:(e,t,r)=>{r.d(t,{q2:()=>v,W6:()=>T,Ob:()=>S,DT:()=>b,Aj:()=>j,T0:()=>C,XG:()=>x,Mj:()=>l});function n(e,t=""){if(e<=0)return t;const r=Math.floor(61*Math.random());return n(e-1,t+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r))}function i(e,t=null,r={}){return arguments.length<2?function(e){const t=function(e){const t={},r=document.cookie.split(/ *; */);if(!r[0])return t;for(const e of r){const[r,n]=e.split("="),i=u(r),s=u(n);i&&s&&(t[i]=s)}return t}();return e?t[e]:""}(e):function(e,t,r={}){const n=[];null===t?(n.push(a(c(e),"null")),r.maxage=-1):n.push(a(c(e),c(t))),r.maxage&&(r.expires=new Date(+new Date+r.maxage)),r.path&&n.push(a(o.Path,r.path)),r.domain&&n.push(a(o.Domain,r.domain)),r.expires&&n.push(a(o.Expires,r.expires.toUTCString())),r.secure&&n.push(o.Secure),r.sameSite&&(n.push(a(o.SameSite,r.sameSite)),r.sameSite!==s.None||r.secure||n.push(o.Secure));const i=n.join(";");return document.cookie=i,i}(e,t,r)}var s,o;function a(e,t){return`${e}=${t}`}function c(e){try{return encodeURIComponent(e)}catch(e){return""}}function u(e){try{return decodeURIComponent(e)}catch(e){return null}}!function(e){e.None="None",e.Lax="Lax",e.Strict="Strict"}(s||(s={})),function(e){e.Path="Path",e.Domain="Domain",e.Expires="Expires",e.Secure="Secure",e.SameSite="SameSite"}(o||(o={}));class l{constructor(e,t){this._logger=e,this._metric=t}getValueStart(e){const t=this._metric.getTimer(`doGet${e}.timer`).start();return{getValueSuccess:()=>{t.stop(),this._metric.getCounter(`doGet${e}.success`).increment()},getValueFailure:r=>{t.stop(),this._metric.getCounter(`doGet${e}.failure`).increment(),this._logger.warn(`doGet${e}.failed`,r)}}}valueGenerated(){this._metric.getCounter("generated").increment()}valueRecovered(){this._metric.getCounter("recovered").increment()}}function h(e){try{return e()}catch(e){return}}const p=/^\.\w+\.\w+/,d=e=>`gnar_test_${e}_${n(5)}`;function f(e){return{type:"success",value:e}}function m(e){return{type:"failure",error:e}}function _(e){return e.then(f,m)}class g{constructor(e,t=[],r=null,n=3e5,i=0,s=(()=>Date.now())){this.primaryStorage=e,this.secondaryStorages=t,this._logger=r,this._cacheSuccessTimeoutMillis=n,this._cacheFailureTimeoutMillis=i,this._getTime=s,this._allStorages=[e,...t]}_expireCache(e){0===e?this._cacheExpireTimestamp=0:e>0&&(this._cacheExpireTimestamp=this._getTime()+e)}getValue(){if(void 0!==this._cache&&(void 0===this._cacheExpireTimestamp||this._getTime()<this._cacheExpireTimestamp))return this._cache;const e=h((()=>this._logger&&this._logger.getValueStart(this.valueLabel()))),t=this._valueFromStorage();return this._cache=t,this._cacheExpireTimestamp=void 0,t.then((e=>{e?this._expireCache(this._cacheSuccessTimeoutMillis):this._cache=void 0}),(e=>{this._cache=void 0})),t.then((t=>{e&&h((()=>e.getValueSuccess()))}),(t=>{e&&h((()=>e.getValueFailure(t)))})),t}_valueFromStorage(){return Promise.all(this._allStorages.map((e=>_(e.safeGetValue(this.key()))))).then((e=>{const[t]=e;if("failure"===t.type)return Promise.reject(`getting value from primary storage '${this.primaryStorage.name}' has failed: ${t.error}`);const r=e.find((e=>"success"===e.type&&void 0!==e.value));if(void 0===r)return Promise.resolve(void 0);const n=r.value,i="success"===t.type&&void 0===t.value,s=e.reduce(((e,t,r)=>"success"===t.type&&t.value!==n?e.concat(r):e),[]);return this.setValue(n,i,!1,s)}))}setValue(e,t=!1,r=!1,n=Array.from(Array(this._allStorages.length).keys())){const i=n.map((t=>_(this._allStorages[t].safeSetValue(this.key(),e))));return Promise.all(i).then((n=>{if(t||r){const[e]=n;if("success"!==e.type)return Promise.reject(`setting ${this.valueLabel()} to primary storage has failed:\n                ${e.error}`)}const i=Promise.resolve(e);return this._cache=i,this._expireCache(this._cacheSuccessTimeoutMillis),i})).then((e=>(t?h((()=>this._logger&&this._logger.valueRecovered())):r&&h((()=>this._logger&&this._logger.valueGenerated())),e)))}}class v extends g{constructor(){super(...arguments),this.containerIdLength=12,this.initialSetPromise=void 0,this.generatedContainerId=void 0,this._key="gnar_containerId",this.getContainerId=()=>super.getValue().then((e=>{if(void 0===e){if(this.initialSetPromise)return this.initialSetPromise;{const e=super.setValue(this.getOrGenerateContainerId(),!1,!0);this.initialSetPromise=e;const t=()=>this.initialSetPromise=void 0;return e.then(t,t),e}}return e}))}key(){return this._key}setKey(e){this._key=e}valueLabel(){return"ContainerId"}getOrGenerateContainerId(){return this.generatedContainerId||(this.generatedContainerId=n(this.containerIdLength)),this.generatedContainerId}}class y{constructor(e){this.name=e}safeSetValue(e,t){return this.ensureAvailable(e).then((()=>this.setValue(e,t)))}safeGetValue(e){return this.ensureAvailable(e).then((()=>this.getValue(e))).then((e=>""===e?void 0:e))}}class b extends y{constructor(){super("localStorage"),this.ensureAvailable=e=>{const t=d(e),r=n(10);return new Promise(((e,n)=>{localStorage.setItem(t,r),localStorage.getItem(t)!==r?n(new Error(`LocalStorage is unavailable.\n          Availability test failed.\n          Tried to set ${t}=${r},\n          the result is ${localStorage.getItem(t)}.`)):e(),localStorage.removeItem(t)}))},this.getValue=e=>{const t=localStorage.getItem(e);return new Promise(((e,r)=>e(null===t?void 0:t)))},this.setValue=(e,t)=>new Promise(((r,n)=>{localStorage.setItem(e,t),r()}))}}class T extends y{constructor(e){if(super("cookie"),this._domain=e,this.ensureAvailable=e=>{const t=d(e),r=n(10);return new Promise(((e,n)=>{i(t,r),i(t)!==r?n(new Error(`CookieStorage is unavailable.\n          Availability test failed.\n          Tried to set ${t}=${r}, the result is ${i(t)}.`)):e(),i(t,null)}))},this.getValue=e=>new Promise(((t,r)=>t(i(e)))),!p.test(e))throw new Error('Incorrect cookie domain provided.\n        Use top-level domain, starting from "."')}_getCookieOptions(){return{path:"/",domain:this._domain,expires:new Date((new Date).setFullYear((new Date).getFullYear()+10)),secure:!0,sameSite:s.None}}setValue(e,t){return new Promise(((r,n)=>{i(e,t,this._getCookieOptions()),r()}))}}class x extends y{constructor(e=void 0){super("memory"),this._value=e,this.ensureAvailable=()=>Promise.resolve()}getValue(e){return Promise.resolve(this._value)}setValue(e,t){return this._value=t,Promise.resolve()}}var w=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};const I=()=>{const e=document.documentElement.clientWidth||document.body.clientWidth,t=document.documentElement.clientHeight||document.body.clientHeight;return{url:document.location.href,referrer:document.referrer,userAgent:navigator.userAgent,containerWidth:e,containerHeight:t,screenWidth:screen.width,screenHeight:screen.height,devicePixelRatio:window.devicePixelRatio}},E=["client","clientVersion","userId","isTest","containerId","instanceId","batchId"],P="gnar_nextPingTimestamp";class S{constructor(e,t,r,i,s,o=null,a=!1,c,u=I,l={},h=new b,p){this._url=e,this._client=t,this._clientVersion=r,this._fetch=i,this._containerIdManager=s,this._logger=o,this._storePingTimestamp=a,this._gaClientOpt=c,this._getWindowProps=u,this._extraPingParams=l,this._localStorage=h,this._bundleEventsTime=p,this._instanceId=n(8),this._batchId=0,this._isUserReady=!1,this._queue=[],this._bundledProps=[],this._sendTimeoutId=null,this.userGetter=void 0,this._withBrowserProps=e=>{const{userAgent:t,containerHeight:r,containerWidth:n,screenHeight:i,screenWidth:s,devicePixelRatio:o,browserName:a,browserVersion:c,deviceSystemName:u,deviceSystemVersion:l}=this._getWindowProps();return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),{userAgent:t,screenWidth:s,screenHeight:i,containerWidth:n,containerHeight:r,devicePixelRatio:o}),a?{browserName:a}:{}),c?{browserVersion:c}:{}),u?{deviceSystemName:u}:{}),l?{deviceSystemVersion:l}:{})},this._eventsUrl="events",this._liteUrl="lite",this._pingMaybe(),this._initTs=Date.now()}track(e,t={lite:!1,sendUserIfExists:!1}){if(0!==e.eventName.indexOf(this._client+"/"))throw new Error(`Event name ${e.eventName} should start with '${this._client}/'`);if(Object.keys(e).forEach((e=>{if(-1!==E.indexOf(e))throw new Error(`Event data should not contain '${e}' prop.`)})),!this._isUserReady&&this.userGetter)try{const e=this.userGetter();e&&this.setUserWithParams(e.userId,{isTest:e.isTest,institutionId:e.institutionId})}catch(e){}return t.sendUserIfExists||this._isUserReady||t.lite&&!t.sendUser?(e.eventName!==`${this._client}/ping`&&this._pingMaybe(),this._send(e,t)):(h((()=>this._logger&&this._logger.trackBeforeSetUser(Date.now()-this._initTs))),this._enqueue(e,t))}setUser(e,t){this._setUser(e,{isTest:t})}setUserWithParams(e,t){this._setUser(e,t)}_setUser(e,t){if(null===e||!/^-?\d+$/.test(e))throw new Error("Invalid userId: "+e);const r=this._userId&&this._userId!==e&&!(/^-/.test(e)&&/^-/.test(this._userId));this._isTest=t.isTest,this._userId=e,this._institutionId=t.institutionId,this._isUserReady||(this._isUserReady=!0,this._execQueue()),r&&this._pingMaybe(!0)}setJWT(e,t){if(null===e||""===e)throw new Error("Invalid JWT token: "+e);const[r,n]=e.split("."),i=JSON.parse(decodeURIComponent(atob(n.replace(/-/g,"+").replace(/_/g,"/")).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")));this._jwt=e,this.setUserWithParams(i.sub,{isTest:t})}setGaClient(e){this._gaClientOpt=e}getContainerId(){return this._containerIdManager.getContainerId()}_setNextPingTimestamp(){return w(this,void 0,void 0,(function*(){const e=function(){const e=new Date;return e.getHours()>2&&e.setDate(e.getDate()+1),e.setHours(3),e.setMinutes(Math.floor(60*Math.random())),e.getTime()}();if(this._nextPingTimestamp=e,this._storePingTimestamp)try{yield this._localStorage.safeSetValue(P,e.toString())}catch(e){h((()=>this._logger&&this._logger.nextPingDateWriteError(e)))}}))}_getNextPingTimestamp(){return w(this,void 0,void 0,(function*(){let e=this._nextPingTimestamp;if(void 0!==e||!this._storePingTimestamp)return e;try{const t=yield this._localStorage.safeGetValue(P);e=t?parseInt(t,10):void 0}catch(t){e=void 0,h((()=>this._logger&&this._logger.nextPingDateReadError(t)))}return e}))}_shouldPing(e){return w(this,void 0,void 0,(function*(){if(e)return!0;{const e=yield this._getNextPingTimestamp();return void 0===e||e<Date.now()}}))}_pingMaybe(e=!1){return w(this,void 0,void 0,(function*(){if(!(yield this._shouldPing(e)))return;yield this._setNextPingTimestamp();const{url:t,referrer:r}=this._getWindowProps(),n={eventName:`${this._client}/ping`,referrer:r,url:t},i={lite:!1,sendUserIfExists:!1,doNotBundle:!0};this._gaClientOpt?this._gaClientOpt.getClientId().then((e=>this.track(Object.assign(Object.assign(Object.assign({},n),this._extraPingParams),{gaClientId:e}),i)),(e=>this.track(Object.assign(Object.assign({},n),this._extraPingParams),i))):this.track(Object.assign(Object.assign({},n),this._extraPingParams),i)}))}pingMaybe(){this._pingMaybe()}_enqueue(e,t){return new Promise(((r,n)=>{this._queue.push([e,t,{resolve:r,reject:n}])}))}_execQueue(){this._queue.forEach((([e,t,{resolve:r,reject:n}])=>{this._send(e,t).then((()=>r())).catch((e=>n(e)))})),this._queue=[]}_withClientProps(e){return Object.assign(Object.assign({},e),{client:this._client,clientVersion:this._clientVersion})}_withUserProps(e){return w(this,void 0,void 0,(function*(){const t=yield this.getContainerId().catch((()=>{}));return Object.assign(Object.assign(Object.assign({},e),{containerId:t,userId:this._userId,isTest:this._isTest}),this._institutionId?{institutionId:this._institutionId}:{})}))}_withInstanceProps(e){const t=this._batchId++;return Object.assign(Object.assign({},e),{instanceId:this._instanceId,batchId:t})}_trackUrl(e){return this._url+"/"+(e.lite?this._liteUrl:this._eventsUrl)+(this._jwt?"-with-token":"")}_send(e,t){return w(this,void 0,void 0,(function*(){try{return e=this._withClientProps(e),(!t.lite||t.lite&&t.sendInstance)&&(e=this._withInstanceProps(e)),(t.sendUserIfExists||!t.lite||t.lite&&t.sendUser)&&(e=yield this._withUserProps(e)),(!t.lite||t.lite&&t.sendBrowser)&&(e=this._withBrowserProps(e)),yield this._doSend(this._trackUrl(t),e,t)}catch(t){throw h((()=>this._logger&&this._logger.sendError(t,e))),t}}))}_doSend(e,t,r){var n;return!r.doNotBundle&&this._bundleEventsTime?(this._bundlePromise=null!==(n=this._bundlePromise)&&void 0!==n?n:new Promise((e=>this._bundleResolver=e)),this._sendTimeoutId&&clearTimeout(this._sendTimeoutId),this._bundledProps.push(t),this._sendTimeoutId=setTimeout((()=>{var t;this._sendTimeoutId=null;const r=this._doFetch(e,this._bundledProps);null===(t=this._bundleResolver)||void 0===t||t.call(this,r),this._bundlePromise=null,this._bundledProps=[]}),this._bundleEventsTime),this._bundlePromise):this._doFetch(e,[t])}_doFetch(e,t){return this._fetch(e,{mode:"cors",credentials:"include",method:"post",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({events:t,jwt:this._jwt})}).then((e=>e.ok?Promise.resolve():Promise.reject(new Error(e.statusText))))}setUserGetter(e){this.userGetter=e}}class C{constructor(){this.history=[]}track(e){return this.history.push(e),Promise.resolve()}pingMaybe(){}setUser(e,t){}setUserWithParams(e,t){}setJWT(e,t){}setGaClient(e){}getContainerId(){return Promise.resolve("dummy_container_id")}setUserGetter(){}}class j{track(e){const t="trackingGnar";try{const r=JSON.parse(localStorage.getItem(t))||[];r.push(e),localStorage.setItem(t,JSON.stringify(r))}catch(e){}return Promise.resolve()}pingMaybe(){}setUser(e,t){}setUserWithParams(e,t){}setJWT(e,t){}setGaClient(e){}getContainerId(){return Promise.resolve("dummy_container_id")}setUserGetter(){}}},13798:(e,t,r)=>{r.d(t,{DI:()=>N,SK:()=>j,it:()=>I,v0:()=>n,yB:()=>o});var n,i,s,o,a,c,u=r(44869),l=r(95934),h=r(1395),p=r(9371),d=r(3688),f=r(64117),m=r(6699);(i=n||(n={})).codec=l.NW({currency:l.Yj,value:l.ai},"Money"),i.eq=u.OW({currency:u.kK,value:u.US}),(s||(s={})).codec=l.NW({price:l.ai,priceMoney:n.codec,fromSeats:l.ai,toSeats:l.ai},"PriceTier"),(o||(o={})).codec=l.E$([l.NW({id:l.ai,title:l.Yj,description:l.Yj,periodMonths:l.ai,price:l.ai,priceMoney:n.codec,regularPlanId:l.ai,regularPrice:l.ai,regularPriceMoney:n.codec}),l.OH({nextPaymentPrice:l.ai,numberOfSeats:l.ai,renewalPrice:l.ai,renewalPriceMoney:n.codec,hasTrial:l.zM,priceTiers:l.YO(s.codec),trialDays:l.ai,renewalPlanId:l.ai})],"PaymentPlan"),(a||(a={})).codec=l.NW({nextPayDate:l.Yj,plan:o.codec},"HardChangePaymentPlan"),(c||(c={})).codec=l.KC([l.eu("payPal"),l.eu("creditCard"),l.eu("stripe"),l.Vx],"PaymentMethod");var _,g,v,y,b,T,x,w,I,E=(e=>(e.mastercard="MasterCard",e.visa="Visa",e.americanExpress="American Express",e.jcb="JCB",e.maestro="Maestro",e.discover="Discover",e.dinersClub="Diners Club",e.unionPay="UnionPay",e.mir="Mir",e.elo="Elo",e.hiper="Hiper",e))(E||{});(_||(_={})).codec=l.KC([m.ZU.createStringEnum(E,"KnownCardType"),l.Yj],"CreditCardType"),(g||(g={})).codec=l.KC([l.E$([l.NW({cardType:_.codec}),l.OH({cardSuffix:l.Yj,expirationMonth:l.ai,expirationYear:l.ai})]),l.Vx],"CreditCard"),(v||(v={})).codec=l.NW({id:l.Yj,description:l.Yj,discountPercent:l.ai,isLifelong:l.zM}),(y||(y={})).codec=l.KC([l.eu("INCLUSIVE"),l.eu("EXCLUSIVE")],"RenewalPriceType"),(b||(b={})).codec=l.E$([l.NW({discountSuppressed:l.zM}),l.OH({countryCode:l.Yj,renewalPriceType:y.codec})],"PricingOptions"),(T||(T={})).codec=l.NW({payPalDisabled:l.zM,americanExpressDisabled:l.zM,disabledCardTypes:l.YO(_.codec)},"PaymentMethodOptions"),(x||(x={})).codec=l.KC([l.eu("RENEWAL"),l.eu("SEAT_EXPANSION"),l.eu("INITIAL_CHARGE"),l.eu("UNKNOWN")],"InvoiceType"),(w||(w={})).codec=l.NW({amount:n.codec,numberOfSeats:l.ai,dueDate:l.Yj,hostedLink:l.Yj,chargeable:l.zM,invoiceType:x.codec},"StripeInvoiceInfo"),(I||(I={})).codec=l.OH({state:l.KC([l.eu("DEFAULT"),l.eu("FROZEN"),l.eu("TRIAL"),l.eu("BILLING_FLOW_MIGRATION_STARTED"),l.eu("BILLING_FLOW_MIGRATION_ENDED")]),paymentMethod:c.codec,creditCard:g.codec,billingFlowMigrationMethod:l.KC([l.eu("DEFAULT"),l.eu("INVOICING")]),usePaymentsApi:l.zM,isPremium:l.zM,nextPayDate:l.Yj,nextRenewalInvoiceDate:l.Yj,lastSubscribedDate:l.Yj,expirationDate:l.Yj,isAppleSubscription:l.zM,isGooglePlaySubscription:l.zM,isCancelled:l.zM,isDunning:l.zM,isPaymentMethodFailed:l.zM,isFree:l.zM,isFreebie:l.zM,isPremiumConversion:l.zM,isLegacyPayPal:l.zM,canCancelPlanSwitch:l.zM,hasInstitutionSubscription:l.zM,currentPlan:o.codec,queuedPlan:o.codec,plans:l.YO(o.codec),hardChangePlans:l.YO(a.codec),institutionDynamicPlans:l.YO(o.codec),institutionPlans:l.YO(o.codec),institutionEduPlans:l.YO(o.codec),proPlans:l.YO(o.codec),pricingOptions:b.codec,proPricingOptions:b.codec,paymentMethodOptions:T.codec,payPalEmail:l.Yj,isOnTrial:l.zM,companyInfo:l.Yj,dunningEndDate:l.Yj,dunningDeactivationDate:l.Yj,campaign:v.codec,proCampaign:v.codec,stripeInvoiceInfo:w.codec,countryCode:l.Yj,regionCode:l.Yj,isUngatedTrialDisabled:l.zM,isEligibleForGr4vyMigration:l.zM},"SubscriptionStatus");const P=l.KC([l.eu("NO_ACTIVE_SUBSCRIPTION"),l.eu("ON_TRIAL"),l.eu("RENEWAL_IN_PROGRESS"),l.eu("MOBILE_SUBSCRIPTION"),l.eu("NOT_MATURE_ENOUGH")],"ReferrerNotEligibleReason");var S,C,j;(S||(S={})).codec=l.NW({referralLink:l.E$([l.NW({notEligibleReason:P}),l.OH({key:l.ch})]),canReferUsersStatus:l.eu("NOT_ELIGIBLE")},"ReferralInfoNoLink"),(C||(C={})).codec=l.E$([l.NW({referralLink:l.NW({key:l.Yj}),referralRewardsLimit:l.ai,referralRewardsReceived:l.ai}),l.OH({canReferUsersStatus:l.KC([l.eu("OK"),l.eu("NOT_ELIGIBLE_FOR_REWARD")]),rewardNotEligibleReason:l.KC([l.ch,P,l.eu("REWARD_LIMIT_EXCEEDED")]),referralHistory:l.YO(l.NW({refereeName:l.Yj,createdAt:l.Yj}))})],"ReferralInfoHasLink"),(j||(j={})).codec=l.KC([S.codec,C.codec],"ReferralInfo");const O=class extends d.K.Base{constructor(e,t,r){super(),this._url=e,this._ajaxFactory=t,this._fingerprints=r,this._ajax=this._ajaxFactory({requestExtender:f.UV.toHeaderAppender(this._fingerprints)})}static getDefaultUrl(e){return`https://subscription${e}/api/v1`}getStatus(){const e=p.tM.get(this._url,"/subscription");return this._ajax.json(e)}getIndividualStatus(){const e=p.tM.get(this._url,"/individual-subscription");return this._ajax.json(e)}getFrozenProSubscriptionStatus(){const e=p.tM.get(this._url,"/subscriptions/frozen/grammarly-pro");return this._ajax.json(e)}getIndividualPlans(e){const t=p.tM.get(this._url,"/individual-plans").queryParam("billingCountryCode",e);return this._ajax.json(t)}getInstitutionalPlans(e){const t=p.tM.get(this._url,"/institutional-plans").queryParam("billingCountryCode",e);return this._ajax.json(t)}cancelSubscription(){const e=p.tM.post(this._url,"/cancel");return this._ajax.empty(e)}renewSubscription(){const e=p.tM.post(this._url,"/renew");return this._ajax.empty(e)}ackPremiumConversion(){const e=p.tM.post(this._url,"/ack-premium-conversion");return this._ajax.empty(e)}generateClientToken(){const e=p.tM.post(this._url,"/token/generateClientToken");return this._ajax.json(e)}getAvailablePlans(){const e=p.tM.get(this._url,"/pricing");return this._ajax.json(e)}changePlan(e){const t=p.tM.post(this._url,"/set-plan").pathParam(e.toString());return this._ajax.empty(t)}changeCurrentPlan(e){const t=p.tM.post(this._url,"/hard-change-plan").pathParam(e.toString());return this._ajax.empty(t)}subscribe(e,t,r,n,i,s){const o=p.tM.post(this._url,"/subscribe").formParam("nonce",t).formParam("planId",e.toString()).formParam("sessionId",r);return n&&o.formParam("billingZip",n),i&&o.formParam("billingCountryCode",i),s&&o.formParam("billingRegionCode",s),this._ajax.empty(o)}getSetupStatus(e){const t=p.tM.get(this._url,`/setup/${e}`);return this._ajax.json(t)}subscribeCard(e,t,r,n){return this.subscribe(e,t,r,n)}subscribeCardSandbox(e="1"){const t=p.tM.post(this._url,"/subscribe").formParam("planId",e).formParam("nonce","fake-valid-nonce").formParam("sessionId","test-session").formParam("billingZip","12345");return this._ajax.empty(t)}updateCreditCard(e,t,r,n){const i=p.tM.post(this._url,"/update-card").formParam("nonce",e);return t&&i.formParam("billingZip",t),r&&i.formParam("billingCountryCode",r),n&&i.formParam("billingRegionCode",n),this._ajax.empty(i)}generateTokenPaypal({cancelUrl:e,returnUrl:t}){const r=p.tM.post(this._url,"/token/paypal").formParam("cancelUrl",e).formParam("returnUrl",t);return this._ajax.json(r)}downloadSingleReceipt(e){const t=p.tM.get(this._url,`/receipt/${e}`);return this._ajax.file(t)}downloadBillingReceipts(){const e=p.tM.get(this._url,"/receipt");return this._ajax.file(e)}downloadSingleProReceipt(e){const t=p.tM.get(this._url,`/grammarly-pro/receipt//${e}`);return this._ajax.file(t)}downloadProBillingReceipts(){const e=p.tM.get(this._url,"/grammarly-pro/receipt");return this._ajax.file(e)}setCompanyInfo(e){const t=p.tM.post(this._url,"/set-company-info").formParam("companyInfo",e);return this._ajax.empty(t)}setProCompanyInfo(e){const t=p.tM.post(this._url,"/grammarly-pro/set-company-info").formParam("companyInfo",e);return this._ajax.empty(t)}getProCompanyInfo(){const e=p.tM.get(this._url,"/grammarly-pro/company-info");return this._ajax.json(e)}subscribeNewInstitution(e){return this._subscribeNewInstitutionInternal(e)}setupTrial(e){const t=p.tM.post(this._url,"/setup/trial").json(e);return this._ajax.json(t)}getSetupTrialStatus(e){const t=p.tM.get(this._url,`/setup/trial/payment-methods/${e}`);return this._ajax.json(t)}sendInvoice(e){return this._subscribeNewInstitutionInternal({...e,stripeInvoice:!0})}subscribeNewInstitutionForNgo(e){return this._subscribeNewInstitutionInternal(e)}subscribeNewInstitutionUsingIndividualPremium(e){return this._subscribeNewInstitutionInternal(e)}isEligibleForBusinessTrial(){const e=p.tM.get(this._url,"/is-eligible-for-business-trial");return this._ajax.json(e)}getInstitutionPlans(){const e=p.tM.get(this._url,"/get-institution-plans");return this._ajax.json(e)}getInstitutionPlansForNgo(){const e=p.tM.get(this._url,"/get-institution-plans-for-ngo");return this._ajax.json(e)}isVoucherValid(e){const t=p.tM.get(this._url,"/voucher",e,"valid");return this._ajax.empty(t)}applyVoucher(e){const t=p.tM.post(this._url,"/voucher",e,"apply");return this._ajax.empty(t)}getPaymentHistory(){const e=p.tM.get(this._url,"/payment-history");return this._ajax.json(e)}updateInstitutionSeats({numberOfSeats:e}){const t=p.tM.post(this._url,"/set-number-of-seats").formParam("numberOfSeats",e.toString());return this._ajax.empty(t)}updateInstitutionPlan({numberOfSeats:e,plan:t}){const r=p.tM.post(this._url,"/change-institution-subscription");return e&&r.formParam("numberOfSeats",e.toString()),t&&r.formParam("plan",t.toString()),this._ajax.empty(r)}getAdjustedVolumePricing(e){const t=p.tM.get(this._url,"/volume-adjust-pricing").pathParam(e.toString());return this._ajax.json(t)}getInstitutionAdjustedPricing(e,t){const r=p.tM.get(this._url,"/institution-subscription-adjust-pricing").queryParam("numberOfSeats",e.toString()).queryParam("plan",t.toString());return this._ajax.json(r)}isPaymentMethodExpired(){const e=p.tM.get(this._url,"/isPaymentMethodExpired");return this._ajax.json(e)}getIndividualPaymentHistory(){const e=p.tM.get(this._url,"/individual/payment-history");return this._ajax.json(e)}getProPaymentHistory(){const e=p.tM.get(this._url,"/grammarly-pro/payment-history");return this._ajax.json(e)}requestRefund(){const e=p.tM.post(this._url,"/individual-subscription/refund");return this._ajax.empty(e)}requestFrozenProSubscriptionRefund(){const e=p.tM.post(this._url,"subscriptions/frozen/grammarly-pro/refund");return this._ajax.empty(e)}validateUSZipCode(e){const t=p.tM.post(this._url,"/zip-code/validate").json({zipCode:e});return this._ajax.json(t)}sendInvoiceDraft(e){const t=p.tM.post(this._url,"/submit-draft-invoice");return Object.entries(e).forEach((([e,r])=>t.formParam(e,r))),this._ajax.empty(t)}getInvoiceDraft(){const e=p.tM.get(this._url,"/get-draft-invoice");return this._ajax.json(e)}voidDraftInvoice(){const e=p.tM.post(this._url,"void-unpaid-invoice");return this._ajax.empty(e)}getCountriesConfiguration(){const e=p.tM.get(this._url,"/country-config");return this._ajax.json(e)}getTaxInformation(e,t,{billingPostalCode:r,billingRegionCode:n,numberOfSeats:i}={}){const s=p.tM.get(this._url,"/tax-info").queryParam("planId",e.toString()).queryParam("billingCountryCode",t);return r&&s.queryParam("billingZip",r),n&&s.queryParam("billingRegionCode",n),i&&s.queryParam("numberOfSeats",i.toString()),this._ajax.json(s)}getOrderStatus(e){const t=p.tM.get(this._url,`/order/${e}`);return this._ajax.json(t)}getReferralInfo(){const e=p.tM.post(this._url,"/referrals/info");return this._ajax.json(e)}createOrder(e,t,r,n){const i=p.tM.post(this._url,"/order/individual").formParam("planId",e.toString()).formParam("billingCountryCode",t);return void 0!==r&&i.formParam("billingZip",r),void 0!==n&&i.formParam("billingRegionCode",n),this._ajax.json(i)}createInstitutionalOrder({planId:e,volume:t,institutionName:r,countryCode:n,postalCode:i,regionCode:s,specialOfferName:o}){const a=p.tM.post(this._url,"/order").formParam("planId",e.toString()).formParam("volume",t.toString()).formParam("institutionName",r).formParam("billingCountryCode",n);return void 0!==i&&a.formParam("billingZip",i),void 0!==s&&a.formParam("billingRegionCode",s),void 0!==o&&a.formParam("specialOfferName",o),this._ajax.json(a)}updatePaymentMethod(e,t,r){const n=p.tM.post(this._url,"/setup/payment-methods").json({billingCountry:e,billingPostalCode:t,billingRegion:r});return this._ajax.json(n)}getPaymentMethodUpdateStatus(e){const t=p.tM.get(this._url,`/setup/update/payment-methods/${e}`);return this._ajax.json(t)}_subscribeNewInstitutionInternal(e){const t=p.tM.post(this._url,"/subscribe-new-institution").formParam("institutionName",e.institutionName).formParam("numberOfSeats",e.numberOfSeats.toString());return"sessionId"in e&&e.sessionId&&t.formParam("sessionId",e.sessionId),"billingCountryCode"in e&&e.billingCountryCode&&t.formParam("billingCountryCode",e.billingCountryCode),"billingRegionCode"in e&&e.billingRegionCode&&t.formParam("billingRegionCode",e.billingRegionCode),"billingZip"in e&&e.billingZip&&t.formParam("billingZip",e.billingZip),"nonce"in e&&e.nonce&&t.formParam("nonce",e.nonce),e.planId&&t.formParam("planId",e.planId.toString()),"voxEnabled"in e&&e.voxEnabled&&t.formParam("voxEnabled",e.voxEnabled.toString()),"stripeInvoice"in e&&e.stripeInvoice&&t.formParam("stripeInvoice",e.stripeInvoice.toString()),"brandTonesEnabled"in e&&e.brandTonesEnabled&&t.formParam("brandTonesEnabled",e.brandTonesEnabled.toString()),"specialOfferName"in e&&e.specialOfferName&&t.formParam("specialOfferName",e.specialOfferName.toString()),this._ajax.json(t)}};O.targetTag="subscription";let N=O;h.eo},75921:(e,t,r)=>{r.d(t,{j:()=>O});const n=/%([0-9A-Fa-f]{2})/g,i=/[^\x20-\x7e\xa0-\xff]/g,s=/\\([\u0000-\u007f])/g,o=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,a=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,c=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/,u=e=>String(e).replace(i,"?");class l{constructor(e,t){this.type=e,this.parameters=t}}const h=(e,t)=>String.fromCharCode(parseInt(t,16));function p(e){const t=a.exec(e);if(!t)throw new TypeError("invalid extended field value");const r=t[1].toLowerCase(),i=t[2];let s;switch(r){case"iso-8859-1":s=u(i.replace(n,h));break;case"utf-8":try{s=decodeURIComponent(i)}catch(e){throw new TypeError("invalid encoded utf-8")}break;default:throw new TypeError("unsupported charset in extended field")}return s}function d(e){let t=c.exec(e);if(!t)throw new TypeError("invalid type format");let r=t[0].length;const n=t[1].toLowerCase();let i;const a=[],u={};let h;for(r=o.lastIndex=";"===t[0].slice(-1)?r-1:r;t=o.exec(e);){if(t.index!==r)throw new TypeError("invalid parameter format");if(r+=t[0].length,i=t[1].toLowerCase(),h=t[2],-1!==a.indexOf(i))throw new TypeError("invalid duplicate parameter");a.push(i),i.indexOf("*")+1!==i.length?"string"!=typeof u[i]&&('"'===h[0]&&(h=h.slice(1,h.length-1).replace(s,"$1")),u[i]=h):(i=i.slice(0,-1),h=p(h),u[i]=h)}if(-1!==r&&r!==e.length)throw new TypeError("invalid parameter format");return new l(n,u)}var f=r(46238),m=r(84647),_=r(69779),g=r(60608),v=r(94855),y=r(18039),b=r(89520);const T={URI:"Promise",map:(e,t)=>e.then(t),of:Promise.resolve.bind(Promise),ap:(e,t)=>Promise.all([e,t]).then((([e,t])=>e(t))),chain:(e,t)=>e.then(t),mapLeft:(e,t)=>e.catch((e=>Promise.reject(t(e)))),bimap:(e,t,r)=>e.then(r,(e=>Promise.reject(t(e)))),throwError:e=>Promise.reject(e)};function x(e){return function(t){return t.catch(e)}}const w=(0,b.h1)(T,{ap:(e,t)=>e.then((e=>t.then(e)))}),{ap:I,apFirst:E,apSecond:P,chain:S,chainFirst:C,map:j}=(0,_.pipeable)(T);var O,N=r(43036),k=r(66202),M=r(9371),R=r(96584);(e=>{let t,r,n;var i;let s;e.create=function(e){return(0,_.pipe)(e,t.fromFetch,r.fromExecutor,g.Tj(n.forPromise))},e.createTE=function(e){return(0,_.pipe)(e,t.fromFetch,r.fromExecutor,g.Tj(n.forTaskEither))},(t||(t={})).fromFetch=e=>(t,r,n)=>i=>{return(0,_.pipe)(v.TX((()=>e(i.url,{body:y.y0(i.body),method:i.method,headers:i.headers,keepalive:i.keepalive,mode:t,credentials:r})),o("request failed on client side")),v.cy((s=i,a=n,e=>e.ok?v.pG(e):(0,_.pipe)((()=>e.text()),v.rT,v.qE((t=>a(t,e,s)))))));var s,a},(r||(r={})).fromExecutor=function(e){return g.zW((({credentials:t="include",errorMapper:r=M.dj.mapToHTTPError,requestExtender:n=M.tM.Extender.identity})=>i=>s=>(0,_.pipe)(i,M.tM.Extender.compose(n,s),f.map((e=>e.build())),v.M1,v.cy(e("cors",t,r)))))},(i=n||(n={})).forTaskEither=g.zW((e=>({...(0,_.pipeable)(v.bP),of:v.bP.of,throwError:v.bP.throwError,ApplicativePar:v.bP,ApplicativeSeq:v.yE,orElse:v.NW,retry:c,...s.forTaskEither(e)}))),i.forPromise=g.zW((e=>{const t=s.forTaskEither(e);return{...(0,_.pipeable)(T),of:T.of,throwError:T.throwError,ApplicativePar:T,ApplicativeSeq:w,orElse:x,retry:a,json:(0,m.flow)(t.json,N.hq),file:(0,m.flow)(t.file,N.hq),text:(0,m.flow)(t.text,N.hq),empty:(0,m.flow)(t.empty,N.hq),jsonWithHeaders:(0,m.flow)(t.jsonWithHeaders,N.hq),fileWithHeaders:(0,m.flow)(t.fileWithHeaders,N.hq),textWithHeaders:(0,m.flow)(t.textWithHeaders,N.hq),headers:(0,m.flow)(t.headers,N.hq)}})),(e=>{e.forTaskEither=function(e){function t(t,i){return(0,_.pipe)(t,e,r(M.dj.MimeType.json),n((e=>e.json())),N.h8(i?e=>(0,_.pipe)(i.decode(e.result),k.bimap((e=>new M.dj.ParseError("json parse error",e)),(t=>({headers:e.headers,result:t})))):k.right))}function i(t){return(0,_.pipe)(t,e,r(M.dj.MimeType.txt,M.dj.MimeType.stream,M.dj.MimeType.vnd,M.dj.MimeType.pdf,M.dj.MimeType.json,M.dj.MimeType.zip),n((e=>e.blob())),v.Tj((({headers:e,result:t})=>({headers:e,result:{title:d(e.get("Content-Disposition")||"downloadedDocument").parameters.filename,data:t}}))))}function s(t){return(0,_.pipe)(t,e,r(M.dj.MimeType.any),n((e=>e.text())))}function o(t){return(0,_.pipe)(t,e,r(M.dj.MimeType.any),v.Tj((e=>({headers:e.headers}))))}return{json:function(e,r){return(0,_.pipe)(t(e,r),v.Tj((({result:e})=>e)))},file:function(e){return(0,_.pipe)(e,i,v.Tj((({result:e})=>e)))},text:function(e){return(0,_.pipe)(e,s,v.Tj((({result:e})=>e)))},empty:function(e){return(0,_.pipe)(e,o,v.Tj(m.constVoid))},jsonWithHeaders:t,fileWithHeaders:i,textWithHeaders:s,headers:o}};const t=e=>e.headers.get("Content-Type")||e.headers.get("content-type");function r(...e){const r=("Accept",n=e.join(","),e=>f.task.of(e.header("Accept",n)));var n;return n=>(0,_.pipe)(n(r),v.cy(function(...e){return v.aN((r=>{if(201===r.status||204===r.status)return!0;{const n=t(r)||M.dj.MimeType.any;return Boolean(n)&&e.some((e=>e===M.dj.MimeType.any||n.indexOf(e)>-1))}}),(r=>new M.Hl({code:-1,message:"Unexpected Content-Type",status:`Expected: ${e.join()}\nActual: ${t(r)}`})))}(...e)))}function n(e){return v.cy((t=>v.TX((()=>e(t).then((e=>({result:e,headers:t.headers})))),o("client parse error"))))}})(s||(s={}));const o=e=>t=>{if("string"==typeof t)return new M.GI(e,t);if(t instanceof Error||null!=(r=t).name||null!=r.code)return M.GI.fromError(e,t);{let r="";try{r=JSON.stringify(t)}catch(e){r=String(t)}return new M.GI(e,`unexpected result: ${r}`)}var r};function a(...e){return t=>(0,_.pipe)(v.TX(t,m.identity),(0,R.L5)(e),N.hq)}function c(...e){return t=>(0,_.pipe)(t(),(0,R.L5)(e))}})(O||(O={}))},3688:(e,t,r)=>{var n;r.d(t,{K:()=>n}),(n||(n={})).Base=class{}},96584:(e,t,r)=>{r.d(t,{L5:()=>d,Xb:()=>p});var n=r(53397),i=r(69779),s=r(58508),o=r(72804),a=r(1395),c=r(65390),u=r(94855),l=r(66202),h=r(87172);a.eo,a.eo,a.eo;class p extends a.eo{constructor(e){super(e||"Not Connected to WS"),this.name="NotConnectedError"}static isNotConnectedError(e){return e instanceof p}}function d(e,t=(()=>!0)){const r=n.fold(s.J7)(e);let a;return e=>(0,o.retrying)(r,(t=>(0,i.pipe)(t.previousDelay,c.fold((()=>e),(r=>(0,i.pipe)(f(t.iterNumber,r),u.g$(e),u.qE((e=>{var r;return null!==(r=e)&&"object"==typeof r&&"stack"in r&&void 0!==r.stack&&(1===t.iterNumber?a=e.stack:void 0!==a&&(e.stack=a)),e}))))))),(e=>l.isLeft(e)&&t(e.left)))}a.eo;const f=(e,t)=>u.BK((()=>h.Bx.Logging.root.getLogger("coreclients.utils").trace(`retryWithDelay: count ${e}, timeout: ${t}`)))},43036:(e,t,r)=>{r.d(t,{NQ:()=>h,h8:()=>l,hq:()=>c,qI:()=>u,uC:()=>p});var n=r(46238),i=r(94855),s=r(84647),o=r(11623),a=r(65390);function c(e){return e().then(o.$v)}const u=(0,s.unsafeCoerce)(i.cy),l=e=>n.map((0,o.qI)(e));function h(e,t,r){return(0,s.pipe)(e,(0,i.AU)((o=>{const c=(0,s.pipe)((0,i.kb)(o),n.delay(r));return(0,s.pipe)(t(o),(0,a.fold)((()=>(0,i.kb)(o)),(t=>{const r=(0,s.pipe)(t,n.chain((()=>(0,i.pG)(void 0)))),o=n.getRaceMonoid().concat(c,r);return(0,s.pipe)(o,(0,i.cy)((()=>e)))})))}),(e=>(0,i.pG)(e))))}const p=e=>()=>Promise.resolve(e())},88661:(e,t,r)=>{r.d(t,{dN:()=>L});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s,o,a=function(){return a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function c(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}function u(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.HTTP_EXCEPTION=1]="HTTP_EXCEPTION",e[e.INVALID_STATE=2]="INVALID_STATE",e[e.LOCK_TIMEOUT=3]="LOCK_TIMEOUT",e[e.STORAGE_CACHE_SET_ERROR=4]="STORAGE_CACHE_SET_ERROR",e[e.STORAGE_CACHE_REMOVE_ERROR=5]="STORAGE_CACHE_REMOVE_ERROR"}(o||(o={}));var l,h=((s={})[o.UNKNOWN]="Unknown error",s[o.HTTP_EXCEPTION]="HTTP Exception",s[o.INVALID_STATE]="Invalid State",s[o.LOCK_TIMEOUT]="Lock Timeout",s[o.STORAGE_CACHE_SET_ERROR]="Error storing tokens",s[o.STORAGE_CACHE_REMOVE_ERROR]="Error removing tokens",s),p=function(e){function t(r,n){void 0===r&&(r=o.UNKNOWN),void 0===n&&(n=h[r]);var i=e.call(this,n)||this;return i.code=r,Object.setPrototypeOf(i,t.prototype),i}return i(t,e),t.codes=o,t}(Error);!function(e){e.INVALID_AUTHORIZATION_CODE="Invalid authorization code",e.INVALID_CLIENT_TYPE="Invalid client type",e.INVALID_CODE_VERIFIER="Invalid code verifier",e.INVALID_ORIGIN="Invalid origin",e.INVALID_PUBLIC_KEY="Invalid public key",e.INVALID_REDIRECT_URI="Invalid redirect uri",e.INVALID_SCOPE="Invalid scope",e.INVALID_GRANT_TYPE="Invalid grant type",e.INVALID_REFRESH_TOKEN="Invalid refresh token",e.ACCESS_DENIED="Access is denied",e.INVALID_CLIENT="Invalid client",e.REVOKE_ERROR="Revoke error",e.NOT_ENABLED="Oauth not enabled",e.NOT_IMPLEMENTED="Not implemented"}(l||(l={}));var d,f,m=function(e){function t(r,n,i){void 0===n&&(n="unknown");var s=e.call(this,p.codes.HTTP_EXCEPTION,i)||this;return s.serverCode=n,s.response=r,Object.setPrototypeOf(s,t.prototype),s}return i(t,e),Object.defineProperty(t.prototype,"status",{get:function(){return this.response.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statusText",{get:function(){return this.response.statusText},enumerable:!1,configurable:!0}),t}(p),_="grammarly.lock.getAccessToken";function g(e,t){return void 0===t&&(t=3),c(this,void 0,void 0,(function(){var r;return u(this,(function(n){switch(n.label){case 0:r=0,n.label=1;case 1:return r<t?[4,e()]:[3,4];case 2:if(n.sent())return[2,!0];n.label=3;case 3:return r++,[3,1];case 4:return[2,!1]}}))}))}function v(e){return void 0===e&&(e=0),c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}function y(e){var t=Math.floor(100*Math.pow(2,e));return Math.floor(Math.random()*(t-100+1))+100}function b(e){return c(this,void 0,void 0,(function(){var t,r,n,i,s,o,l,h,p=this;return u(this,(function(d){switch(d.label){case 0:t=a({backoffFn:function(e){var t=e.tryNo;return c(p,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,v(Math.round(y(t)))];case 1:return e.sent(),[2]}}))}))},maxRetries:10},e),r=0,n=!1,i=null,s=null,o=Date.now(),l=function(){n=!0},d.label=1;case 1:if(!(r<=t.maxRetries))return[3,8];d.label=2;case 2:return d.trys.push([2,4,,7]),[4,t.fn({tryNo:r,startedAt:o,abort:l})];case 3:return[2,{result:s=d.sent(),error:null}];case 4:return h=d.sent(),i=h,++r,n?[3,8]:r<=t.maxRetries?[4,t.backoffFn({tryNo:r,startedAt:o,abort:l})]:[3,6];case 5:d.sent(),d.label=6;case 6:return[3,7];case 7:return[3,1];case 8:return[2,{error:i,result:s}]}}))}))}function T(e){return c(this,void 0,void 0,(function(){var t=this;return u(this,(function(r){switch(r.label){case 0:return[4,b({maxRetries:1,fn:function(r){return c(t,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(r)];case 1:return[2,n.sent()];case 2:throw(t=n.sent())instanceof m&&(i=t.status)>=d.BAD_REQUEST&&i<d.INTERNAL_SERVER_ERROR&&t.status!==d.TOO_MANY_REQUESTS&&r.abort(),t;case 3:return[2]}var i}))}))}})];case 1:return[2,r.sent()]}}))}))}!function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"}(d||(d={})),function(e){e.APPLICATION_JSON="application/json"}(f||(f={}));var x=function(){function e(e,t){this._fetch=e,this._config=t}return e.prototype.get=function(e){return c(this,void 0,void 0,(function(){var t,r,n,i,s,o=this;return u(this,(function(a){switch(a.label){case 0:return[4,this._getHeaders()];case 1:return t=a.sent(),r=function(){return c(o,void 0,void 0,(function(){var r;return u(this,(function(n){switch(n.label){case 0:return[4,this._fetchWithTimeout(e,{credentials:"include",mode:"cors",headers:t})];case 1:return r=n.sent(),[2,this._parseResponse(e,r)]}}))}))},[4,T(r)];case 2:if(n=a.sent(),i=n.result,s=n.error,null!=i)return[2,i];if(null!=s)throw s;throw new Error("Unexpected HttpClient error")}}))}))},e.prototype.post=function(e,t){return c(this,void 0,void 0,(function(){var r,n,i,s,o,l=this;return u(this,(function(h){switch(h.label){case 0:return[4,this._getHeaders()];case 1:return r=h.sent(),n=function(){return c(l,void 0,void 0,(function(){var n;return u(this,(function(i){switch(i.label){case 0:return[4,this._fetchWithTimeout(e,{method:"post",credentials:"include",mode:"cors",headers:a(a({},r),{"Content-Type":f.APPLICATION_JSON}),body:JSON.stringify(t)})];case 1:return n=i.sent(),[2,this._parseResponse(e,n)]}}))}))},[4,T(n)];case 2:if(i=h.sent(),s=i.result,o=i.error,null!=s)return[2,s];if(null!=o)throw o;throw new Error("Unexpected HttpClient error")}}))}))},e.prototype._fetchWithTimeout=function(e,t){return void 0===t&&(t={}),c(this,void 0,void 0,(function(){var r,n=this;return u(this,(function(i){return r=this._fetch(e,t),this._config.timeout?[2,Promise.race([r,new Promise((function(e,t){return setTimeout((function(){return t(new Error("Fetch Timeout"))}),n._config.timeout)}))])]:[2,r]}))}))},e.prototype._getHeaders=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return this._config.applicationHeaders?[2,this._config.applicationHeaders]:this._config.getApplicationHeaders?[4,this._config.getApplicationHeaders()]:[3,2];case 1:return[2,e.sent()];case 2:throw new Error("Cannot get application headers")}}))}))},e.prototype._parseResponse=function(e,t){return c(this,void 0,void 0,(function(){var r,n;return u(this,(function(i){switch(i.label){case 0:if(t.status>=d.INTERNAL_SERVER_ERROR)throw new m(t,"unknown","HTTP server error ".concat(t.status,". Unable to fetch ").concat(e));return[4,t.clone().json().catch((function(e){return{error:"unknown",message:e.message}}))];case 1:if(r=i.sent(),n=r.message||"HTTP error. Unable to fetch ".concat(e),!t.ok)throw new m(t,r.error,n);return[4,t.json()];case 2:return[2,i.sent()]}}))}))},e}(),w=function(){function e(e,t,r){this._tokensUrl=e,this._httpClient=new x(t,r)}return e.prototype.getTokens=function(e){return this._httpClient.post(this._tokensUrl+"/oauth2/token",e)},e.prototype.exchangeTokens=function(e){return this._httpClient.post(this._tokensUrl+"/oauth2/exchange",e)},e}();function I(e){var t=e.tokensClient,r=e.clientId,n=e.grantType,i=e.codeVerifier,s=e.authorizationCode,o=e.refreshToken;return c(this,void 0,void 0,(function(){var e;return u(this,(function(c){switch(e={client_id:r,grant_type:n},n){case"refresh_token":e=a(a({},e),{refresh_token:o});break;case"authorization_code":e=a(a({},e),{code_verifier:i,authorization_code:s});break;case"urn:ietf:params:oauth:grant-type:token-exchange":return e=a(a({},e),{subject_token_type:"urn:grammarly:params:oauth:token-type:grauth"}),[2,t.exchangeTokens(e)]}return[2,t.getTokens(e)]}))}))}function E(e){if(e&&e.expires_at&&e.access_token&&e.refresh_token){var t=(new Date).getTime();return e.expires_at-t<=0?null:e}return null}function P(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function S(e){return void 0===e&&(e=0),c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:return t.sent(),[2]}}))}))}var C=P();function j(e){return"".concat(C,":").concat(e,":").concat(Math.floor(1e6*(1+Math.random())))}function O(){return Math.floor(1+9*Math.random())}function N(e,t,r,n,i){return c(this,void 0,void 0,(function(){function s(t){return c(this,void 0,void 0,(function(){var r,i;return u(this,(function(s){switch(s.label){case 0:return[4,e.getItem(t)];case 1:return null==(r=s.sent())?[2,!1]:r===d?[2,!0]:(i=parseInt(String(r.split(":")[1]),10),[2,!Number.isFinite(i)||i+n<Date.now()])}}))}))}function o(){return c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,s(l)];case 1:return t.sent()?[4,e.removeItem(l)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,s(h)];case 4:return t.sent()?[4,e.removeItem(h)]:[3,6];case 5:t.sent(),t.label=6;case 6:return[2]}}))}))}var a,l,h,d,f;return u(this,(function(n){switch(n.label){case 0:a=Date.now(),l="".concat(t,"__$$MUTEX_x"),h="".concat(t,"__$$MUTEX_y"),d=j(a),n.label=1;case 1:return[4,o()];case 2:if(n.sent(),Date.now()-a>r)throw new p(p.codes.LOCK_TIMEOUT,'"Mutex on '.concat(t," was not achieved in ").concat(r,"ms"));return[4,e.getItem(l)];case 3:return null==n.sent()?[3,5]:[4,S(O())];case 4:return n.sent(),[3,1];case 5:return[4,e.setItem(l,d)];case 6:return n.sent(),[4,e.getItem(h)];case 7:return null==n.sent()?[3,9]:[4,S(O())];case 8:return n.sent(),[3,1];case 9:return[4,e.setItem(h,d)];case 10:return n.sent(),[4,S(O())];case 11:return n.sent(),[4,e.getItem(l)];case 12:return n.sent()===d?[3,17]:[4,S(O())];case 13:return n.sent(),[4,e.getItem(h)];case 14:return n.sent()===d?[3,16]:[4,S(O())];case 15:n.sent(),n.label=16;case 16:return[3,1];case 17:return n.trys.push([17,,21,24]),f=j(Date.now()),[4,e.setItem(l,f)];case 18:return n.sent(),[4,e.setItem(h,f)];case 19:return n.sent(),[4,i()];case 20:return n.sent(),[3,24];case 21:return[4,e.removeItem(l)];case 22:return n.sent(),[4,e.removeItem(h)];case 23:return n.sent(),[7];case 24:return[3,25];case 25:return[2]}}))}))}var k,M=function(){function e(e){this.locks=new Map,this.storage=e}return e.prototype.acquireLock=function(e){return c(this,void 0,void 0,(function(){var t=this;return u(this,(function(r){return[2,new Promise((function(r){return c(t,void 0,void 0,(function(){var t=this;return u(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,N(this.storage,e,6e4,5e3,(function(){return c(t,void 0,void 0,(function(){var t=this;return u(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){t.locks.set(e,n),r(!0)}))];case 1:return n.sent(),[2]}}))}))}))];case 1:return n.sent(),[3,3];case 2:return n.sent(),r(!1),[3,3];case 3:return[2]}}))}))}))]}))}))},e.prototype.releaseLock=function(e){return c(this,void 0,void 0,(function(){var t;return u(this,(function(r){return null!=(t=this.locks.get(e))&&t(),this.locks.delete(e),[2]}))}))},e}(),R=function(){function e(e,t){this._storage=e,this._storageKey=t}return e.prototype.set=function(e){return c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._storage.setItem(this._storageKey,JSON.stringify(e))];case 1:return t.sent(),[2,e];case 2:throw t.sent(),new p(o.STORAGE_CACHE_SET_ERROR);case 3:return[2]}}))}))},e.prototype.get=function(){return c(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._storage.getItem(this._storageKey)];case 1:return[2,(e=t.sent())?JSON.parse(e):null];case 2:return t.sent(),[2,null];case 3:return[2]}}))}))},e.prototype.remove=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._storage.removeItem(this._storageKey)];case 1:return e.sent(),[3,3];case 2:throw e.sent(),new p(o.STORAGE_CACHE_REMOVE_ERROR);case 3:return[2]}}))}))},e}(),A=function(){function e(){this.cache=new Map}return Object.defineProperty(e.prototype,"length",{get:function(){return this.cache.size},enumerable:!1,configurable:!0}),e.prototype.getItem=function(e){return this.cache.has(e)?this.cache.get(e):null},e.prototype.setItem=function(e,t){this.cache.set(e,String(t))},e.prototype.removeItem=function(e){this.cache.delete(e)},e.prototype.key=function(e){return function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}(this.cache.keys()),!1)[e]||null},e.prototype.clear=function(){this.cache=new Map},e}(),U=function(){function e(e){var t;this._promiseMap=new Map,this._clientId=e.clientId,this._anonymousTokenClientType=e.anonymousTokenClientType,this._redirectUri=e.redirectUri,this._domain=(t=e.domain,/^https?:\/\//.test(t)?t:"https://".concat(t)),this._tokensClient=new w(this._domain,e.fetch,e.httpClientOptions),this._storageKey=e.storageKey||"grammarly.".concat(this._clientId,".tokens"),this._storage=e.storage||new A,this._lock=e.lock||new M(this._storage),this._cache=new R(this._storage,this._storageKey),this._tracking=e.tracking}return e.prototype._exchangeToken=function(e){var t=this,r=e.orAnonymous;return function(e){return I({tokensClient:e.tokensClient,clientId:e.clientId,grantType:"urn:ietf:params:oauth:grant-type:token-exchange"})}({tokensClient:this._tokensClient,clientId:this._clientId}).catch((function(e){if(!(e instanceof m))throw e;if(r&&e.status===d.UNAUTHORIZED)return function(e){var t=e.tokensClient,r=e.clientId,n=e.clientType;return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,I({tokensClient:t,clientId:r,grantType:"Web"===n?"urn:ietf:params:oauth:grant-type:origin":"urn:ietf:params:oauth:grant-type:client_id"})];case 1:return[2,e.sent()]}}))}))}({tokensClient:t._tokensClient,clientId:t._clientId,clientType:t._anonymousTokenClientType});throw e}))},e.prototype._refresh=function(e,t){var r=this;return function(e){var t=e.tokensClient,r=e.clientId,n=e.refreshToken;return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,I({tokensClient:t,clientId:r,grantType:"refresh_token",refreshToken:n})];case 1:return[2,e.sent()]}}))}))}({tokensClient:this._tokensClient,clientId:this._clientId,refreshToken:e}).catch((function(e){if(e instanceof m&&e.status===d.UNAUTHORIZED)return r._exchangeToken(t);throw e}))},e.prototype._getAccessToken=function(e){var t,r,n,i,s;return c(this,void 0,void 0,(function(){var a,c,l,h,d,f,m=this;return u(this,(function(u){switch(u.label){case 0:return u.trys.push([0,16,,17]),(a=e.ignoreCache)?[3,2]:(c=E,[4,this._cache.get()]);case 1:if(h=c.apply(void 0,[u.sent()]))return[2,h.access_token];u.label=2;case 2:return[4,g((function(){return m._lock.acquireLock(_,5e3)}),10)];case 3:if(!u.sent())return[3,14];u.label=4;case 4:return u.trys.push([4,,11,13]),[4,this._cache.get()];case 5:return l=u.sent(),!a&&(h=E(l))?[2,h.access_token]:(d=void 0,!a&&l&&l.refresh_token?[3,7]:(null===(t=this._tracking)||void 0===t||t.getTokensAttemptWithoutRefreshToken(),[4,this._exchangeToken(e)]));case 6:return d=u.sent(),[3,9];case 7:return null===(r=this._tracking)||void 0===r||r.getTokensAttemptWithRefreshToken(),[4,this._refresh(l.refresh_token,e)];case 8:d=u.sent(),u.label=9;case 9:return null===(n=this._tracking)||void 0===n||n.getTokensSuccess(),[4,this._cache.set((v=d,{expires_at:(new Date).getTime()+1e3*v.expires_in,access_token:v.access_token,refresh_token:v.refresh_token,refresh_token_expires_at:(new Date).getTime()+1e3*v.refresh_token_expires_in}))];case 10:return[2,u.sent().access_token];case 11:return[4,this._lock.releaseLock(_)];case 12:return u.sent(),[7];case 13:return[3,15];case 14:throw null===(i=this._tracking)||void 0===i||i.lockTimeout(),new p(o.LOCK_TIMEOUT);case 15:return[3,17];case 16:throw f=u.sent(),null===(s=this._tracking)||void 0===s||s.getTokensFailure(f),f;case 17:return[2]}var v}))}))},e.prototype.getAccessToken=function(e){var t=this;void 0===e&&(e={orAnonymous:!1,ignoreCache:!1});var r="".concat(e.orAnonymous,"::").concat(e.ignoreCache),n=this._promiseMap.get(r);return n||(n=this._getAccessToken(e).finally((function(){t._promiseMap.delete(r),n=void 0})),this._promiseMap.set(r,n)),n},e.prototype.logout=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this._cache.remove()];case 1:return e.sent(),[2]}}))}))},e}(),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(U);i((function(){return null!==k&&k.apply(this,arguments)||this}),k=U),function(e){i((function(){return null!==e&&e.apply(this,arguments)||this}),e)}(U)}}]);